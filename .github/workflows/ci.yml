name: CI

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Neovim
        uses: rhysd/action-setup-vim@v1
        with:
          neovim: true
          version: latest

      - name: Install emmylua_check
        run: |
          mkdir -p ~/.local/bin
          curl -L https://github.com/EmmyLuaLS/emmylua-analyzer-rust/releases/download/0.1.0/emmylua_check-x86_64-unknown-linux-gnu -o ~/.local/bin/emmylua_check
          chmod +x ~/.local/bin/emmylua_check
          echo "$HOME/.local/bin" >> $GITHUB_PATH

      - name: Install stylua
        uses: JohnnyMorganz/stylua-action@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Run emmylua-check
        run: make emmylua-check

      - name: Run stylua check
        run: stylua --check lua/
